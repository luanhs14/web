<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Abas - Money Planner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #0e1117;
            color: #fff;
        }
        .test-result {
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            background: #1f2632;
        }
        .success { border-left: 4px solid #34d399; }
        .error { border-left: 4px solid #f87171; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        .primary { background: #388bfd; color: white; }
        .secondary { background: #34d399; color: white; }
    </style>
</head>
<body>
    <h1>üß™ Teste de Diagn√≥stico - Money Planner</h1>

    <div class="test-result success">
        <h2>‚úÖ Status do Servidor</h2>
        <p id="serverStatus">Verificando...</p>
    </div>

    <div class="test-result">
        <h2>üîç Testes</h2>
        <button class="primary" onclick="testAPI()">Testar API</button>
        <button class="secondary" onclick="testMainSite()">Testar Site Principal</button>
        <button class="primary" onclick="testTabs()">Testar Abas</button>
        <button class="secondary" onclick="clearCache()">Instru√ß√µes de Cache</button>
    </div>

    <div id="results"></div>

    <script>
        async function testAPI() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="test-result"><p>Testando API...</p></div>';

            try {
                const response = await fetch('/api/health');
                const data = await response.json();

                if (data.success) {
                    results.innerHTML = `
                        <div class="test-result success">
                            <h3>‚úÖ API Funcionando!</h3>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    results.innerHTML = `
                        <div class="test-result error">
                            <h3>‚ùå Erro na API</h3>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                results.innerHTML = `
                    <div class="test-result error">
                        <h3>‚ùå Erro ao conectar com API</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function testMainSite() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="test-result"><p>Testando site principal...</p></div>';

            try {
                const response = await fetch('/');
                const html = await response.text();

                const hasAccountsTab = html.includes('data-tab="accounts"');
                const hasSettingsTab = html.includes('data-tab="settings"');
                const hasDashboardTab = html.includes('data-tab="dashboard"');

                results.innerHTML = `
                    <div class="test-result ${hasAccountsTab && hasSettingsTab ? 'success' : 'error'}">
                        <h3>Verifica√ß√£o do HTML</h3>
                        <p>Dashboard: ${hasDashboardTab ? '‚úÖ' : '‚ùå'}</p>
                        <p>Abas Contas: ${hasAccountsTab ? '‚úÖ' : '‚ùå'}</p>
                        <p>Abas Config: ${hasSettingsTab ? '‚úÖ' : '‚ùå'}</p>
                        ${hasAccountsTab && hasSettingsTab ?
                            '<p><strong>‚úÖ Todas as abas est√£o no HTML!</strong></p>' :
                            '<p><strong>‚ùå Algumas abas est√£o faltando no HTML</strong></p>'
                        }
                    </div>
                `;
            } catch (error) {
                results.innerHTML = `
                    <div class="test-result error">
                        <h3>‚ùå Erro ao carregar site</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        function testTabs() {
            const results = document.getElementById('results');

            // Abrir o site principal em nova aba
            window.open('/', '_blank');

            results.innerHTML = `
                <div class="test-result success">
                    <h3>üîç Site principal aberto em nova aba</h3>
                    <p>Verifique se as 3 abas aparecem:</p>
                    <ul>
                        <li>üè† Dashboard</li>
                        <li>üìù Contas</li>
                        <li>‚öôÔ∏è Config</li>
                    </ul>
                    <p><strong>Se n√£o aparecerem:</strong></p>
                    <ol>
                        <li>Abra o DevTools (F12)</li>
                        <li>V√° na aba "Console"</li>
                        <li>Veja se h√° erros em vermelho</li>
                        <li>Tire um print e compartilhe</li>
                    </ol>
                </div>
            `;
        }

        function clearCache() {
            const results = document.getElementById('results');
            results.innerHTML = `
                <div class="test-result success">
                    <h3>üßπ Como Limpar o Cache</h3>

                    <h4>Chrome / Edge:</h4>
                    <ol>
                        <li>Pressione <code>Ctrl + Shift + Delete</code></li>
                        <li>Selecione "Imagens e arquivos em cache"</li>
                        <li>Clique em "Limpar dados"</li>
                        <li>OU pressione <code>Ctrl + F5</code> para for√ßar atualiza√ß√£o</li>
                    </ol>

                    <h4>Firefox:</h4>
                    <ol>
                        <li>Pressione <code>Ctrl + Shift + Delete</code></li>
                        <li>Selecione "Cache"</li>
                        <li>Clique em "Limpar agora"</li>
                    </ol>

                    <h4>Safari (Mac):</h4>
                    <ol>
                        <li>Pressione <code>Cmd + Option + E</code></li>
                        <li>Recarregue a p√°gina com <code>Cmd + Shift + R</code></li>
                    </ol>

                    <h4>Teste em Aba An√¥nima:</h4>
                    <p>
                        <strong>Chrome/Edge:</strong> <code>Ctrl + Shift + N</code><br>
                        <strong>Firefox:</strong> <code>Ctrl + Shift + P</code>
                    </p>
                </div>
            `;
        }

        // Teste inicial
        window.addEventListener('DOMContentLoaded', async () => {
            const serverStatus = document.getElementById('serverStatus');
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                serverStatus.innerHTML = `
                    ‚úÖ Servidor Online<br>
                    <small>Timestamp: ${data.timestamp}</small>
                `;
            } catch (error) {
                serverStatus.innerHTML = '‚ùå Servidor Offline: ' + error.message;
                serverStatus.parentElement.className = 'test-result error';
            }
        });
    </script>
</body>
</html>
