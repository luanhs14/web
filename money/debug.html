<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Money Planner</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #0e1117;
            color: #34d399;
            line-height: 1.6;
        }
        .log {
            margin: 5px 0;
            padding: 5px;
            background: #1f2632;
            border-left: 3px solid #34d399;
        }
        .error {
            color: #f87171;
            border-left-color: #f87171;
        }
        .success {
            color: #34d399;
        }
        h1 { color: #388bfd; }
        button {
            background: #388bfd;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 5px 10px 0;
        }
    </style>
</head>
<body>
    <h1>üîç Debug Console - Money Planner</h1>
    <button onclick="testScripts()">Testar Scripts</button>
    <button onclick="testAPI()">Testar API</button>
    <button onclick="testDOM()">Testar DOM</button>
    <button onclick="location.href='/'">Ir para Site</button>
    <div id="logs"></div>

    <script>
        const logs = document.getElementById('logs');

        function log(msg, isError = false) {
            const div = document.createElement('div');
            div.className = isError ? 'log error' : 'log success';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logs.appendChild(div);
            console.log(msg);
        }

        function testScripts() {
            logs.innerHTML = '';
            log('üß™ Testando carregamento de scripts...');

            // Testar Chart.js
            if (typeof Chart !== 'undefined') {
                log('‚úÖ Chart.js carregado - vers√£o: ' + Chart.version);
            } else {
                log('‚ùå Chart.js N√ÉO carregado', true);
            }

            // Testar EmailJS
            if (typeof emailjs !== 'undefined') {
                log('‚úÖ EmailJS carregado');
            } else {
                log('‚ùå EmailJS N√ÉO carregado', true);
            }

            // Testar jsPDF
            if (typeof window.jspdf !== 'undefined') {
                log('‚úÖ jsPDF carregado');
            } else {
                log('‚ùå jsPDF N√ÉO carregado', true);
            }

            // Carregar e testar api.js
            fetch('/api.js')
                .then(r => r.text())
                .then(() => log('‚úÖ api.js carregado'))
                .catch(e => log('‚ùå api.js erro: ' + e.message, true));

            // Carregar e testar app.js
            fetch('/app.js')
                .then(r => r.text())
                .then(text => {
                    log('‚úÖ app.js carregado (' + text.length + ' bytes)');

                    // Verificar se tem erros de sintaxe
                    try {
                        new Function(text);
                        log('‚úÖ app.js sem erros de sintaxe');
                    } catch (e) {
                        log('‚ùå app.js tem erro de sintaxe: ' + e.message, true);
                    }
                })
                .catch(e => log('‚ùå app.js erro: ' + e.message, true));
        }

        async function testAPI() {
            logs.innerHTML = '';
            log('üß™ Testando API...');

            try {
                const response = await fetch('/api/health');
                const data = await response.json();

                if (data.success) {
                    log('‚úÖ API respondendo: ' + data.message);
                } else {
                    log('‚ùå API erro: ' + JSON.stringify(data), true);
                }

                // Testar accounts
                const accounts = await fetch('/api/accounts');
                const accountsData = await accounts.json();
                log('‚úÖ Contas carregadas: ' + accountsData.data.length + ' contas');

                // Testar settings
                const settings = await fetch('/api/settings');
                const settingsData = await settings.json();
                log('‚úÖ Settings carregados');

            } catch (error) {
                log('‚ùå Erro na API: ' + error.message, true);
            }
        }

        function testDOM() {
            logs.innerHTML = '';
            log('üß™ Testando estrutura HTML...');

            fetch('/')
                .then(r => r.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');

                    // Verificar abas
                    const tabBtns = doc.querySelectorAll('.tab-btn');
                    log(`‚úÖ Bot√µes de abas encontrados: ${tabBtns.length}`);

                    tabBtns.forEach(btn => {
                        const tab = btn.getAttribute('data-tab');
                        log(`   - ${btn.textContent.trim()} (data-tab="${tab}")`);
                    });

                    // Verificar conte√∫dos
                    const contents = doc.querySelectorAll('.tab-content');
                    log(`‚úÖ Conte√∫dos de abas encontrados: ${contents.length}`);

                    contents.forEach(content => {
                        log(`   - #${content.id}`);
                    });

                    // Verificar scripts
                    const scripts = doc.querySelectorAll('script[src]');
                    log(`‚úÖ Scripts externos: ${scripts.length}`);

                    scripts.forEach(script => {
                        log(`   - ${script.src}`);
                    });

                    // Verificar se mainApp existe
                    const mainApp = doc.getElementById('mainApp');
                    if (mainApp) {
                        log('‚úÖ #mainApp encontrado');
                    } else {
                        log('‚ùå #mainApp N√ÉO encontrado', true);
                    }

                    // Verificar header
                    const header = doc.querySelector('header');
                    if (header) {
                        log('‚úÖ <header> encontrado');
                    } else {
                        log('‚ùå <header> N√ÉO encontrado', true);
                    }
                })
                .catch(e => log('‚ùå Erro ao carregar HTML: ' + e.message, true));
        }

        // Auto-teste ao carregar
        window.addEventListener('DOMContentLoaded', () => {
            log('üöÄ Debug Console iniciado');
            log('üí° Clique nos bot√µes acima para testar');
        });
    </script>
</body>
</html>
